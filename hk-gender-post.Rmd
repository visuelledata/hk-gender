---
title: Women significantly outnumber men in Hong Kong
author: Chris Peralta
date: '2017-10-20'
slug: hk-gender
categories:
  - R
tags:
  - ggplot2
  - data visualization
  - design
description: ''
#output: md_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(forcats)
library(SciencesPo)
library(scales)
library(stringr)
library(grid)
library(gridExtra)

grouped <- pop %>%  
  group_by(age_range, sex) %>% 
  summarize(population = sum(population, na.rm = TRUE)) %>% 
  mutate(prop = population / sum(population))


```

Women significantly outnumber men in Hong Kong. In this paper, I will show you the degree to which men are outnumbered and how significant the gap is. 

## How badly do women outnumber men?

Women make up `r percent(sum(filter(pop, sex == 'female')$population, na.rm = TRUE) / sum(pop$population, na.rm = TRUE))` of the population, while men make up `r percent(1 - sum(filter(pop, sex == 'female')$population, na.rm = TRUE) / sum(pop$population, na.rm = TRUE))` of the population. 

This might not seem excessive, but I'm going to break it down to give you a better picture. First, lets look at a population pyramid so we can get an idea of what the distribution of Hong Kong's population looks like. 

```{r cars}
#overall pop dist
overall_pop_dist <- pop_pyr_format(pop) %>% 
  ggplot(aes(x = age_range, y = prop, fill = sex)) +  
  geom_bar(stat = 'identity', width = .9) +   
  geom_text(aes(x = age_range, y = 0, label = age_range), 
            color = 'white', size = 4.5, nudge_x = .05) + 
  coord_flip(ylim = c(-.1, .1)) +
  scale_y_continuous(breaks = seq(-.1, .1, .02), 
                     labels = paste0(as.character(c(seq(10, 0, -2), seq(2, 10, 2))), '%')) +
  scale_fill_manual(values = c(men.scale[5], women.scale[5])) + 
  theme_pub(axis_line = TRUE) + 
  labs(x = 'Age Range\n', y = '\nPopulation') +
  theme(panel.grid.major = element_line(size = .75),
        axis.text = element_text(size = 8.35)) +
  no_major_y_gridlines() +
  no_legend() + 
  no_y_text() + 
  no_y_line() + 
  no_y_ticks() +
  annotate(geom = 'text', x = 14.2, y = -.0725, 
           label = 'Female', color = women.scale[[4]], size = 3.5) +
  annotate(geom = 'text', x = 14.2, y = .065, 
           label = 'Male', color = men.scale[[4]], size = 3.5)

title_align_no_clip(plot = overall_pop_dist, 
                    title_segments = c('Hong Kong Population Pyramid'),
                    colors = c('Grey25'))
```

From this we see that people from 30-59 make up a large portion of the population with women outnumbering men. 

Now, I'll put the bars side by side as percentages, so it will be easier to compare them.  

```{r pressure, echo=FALSE}
#population by age and gender
grouped %>% 
  ggplot(aes(x = age_range, y = prop, color = sex, group = sex)) +
  geom_hline(yintercept = .5, linetype = 'dotted', color = 'grey20') + 
  geom_linerange(aes(ymin = 0, ymax = prop), 
                 position = position_dodge(width = .5), color = 'grey60') + 
  geom_point(size = 6, position = position_dodge(width = .5)) + 
  labs(x = '\nAge range', y = 'Percent within age group\n') + 
  scale_color_manual(values = c(men.scale[5], women.scale[5])) + 
  scale_y_continuous(limits = c(0, .7),expand = c(0,0)) +
  theme(axis.text.x = element_text(angle = 80, vjust = .2, hjust = .2)) + 
  no_legend()
  
title_align_no_clip(title_segments = c('Percent of ', 'men', ' and ', 'women ', 'within each age group'),
                    colors = c('Grey25', men.scale[4], 'Grey25', women.scale[4], 'Grey25'),
                    axis_title_color = 'Grey40', 
                    axis_text_color =  'Grey40',
                    axis_x_line_color = 'Grey35',
                    axis_y_line_color = 'Grey35', 
                    tick_color = 'Grey35')
```

First, lets look at some of the individual points

```{r }
#highlight ends
grouped %>% 
  mutate(condition = sex == "female" & (age_range == '0 - 4' | age_range == '5 - 9' | age_range == '75 - 79' | 
                                        age_range == '80 - 84'| age_range == '85+')) %>%
  mutate(condition = any(condition)) %>% 
  ggplot(aes(x = age_range, y = prop, color = sex, group = sex)) +
  geom_linerange(aes(ymin = 0, ymax = prop), 
                 position = position_dodge(width = .5), color = 'grey95') + 
  geom_linerange(aes(ymin = 0, ymax = prop, alpha = condition), 
                 position = position_dodge(width = .5), color = 'grey50') + 
  geom_point(size = 6, position = position_dodge(width = .5), color = 'grey95') + 
  geom_point(aes(alpha = condition), 
             size = 6, position = position_dodge(width = .5)) + 
  labs(x = '\nAge range', y = 'Percent within age group\n') + 
  scale_color_manual(values = c(men.scale[5], women.scale[5])) +
  scale_y_continuous(limits = c(0, .7),expand = c(0,0)) +
  theme(axis.text.x = element_text(angle = 80, vjust = .2, hjust = .2)) + 
  no_legend() + 
  annotate(geom = 'text', x = .8, y = .59, hjust = 0, 
           color = 'Grey50', size = 3.8,
           label = c('More boys are born \nthan girls globally')) + 
  annotate(geom = 'text', x = 14.1, y = .61, hjust = 0, 
           color = 'Grey50', size = 3.8,
           label = c('Women have longer \nlife expectancies than \nmen'))

title_align_no_clip(title_segments = c('These data points are caused by ', 'birth', ' and ', 'life expectancy ', 'phenomena.'),
                    colors = c('Grey40', 'Grey20', 'Grey40', 'Grey20', 'Grey40'),
                    axis_title_color = 'Grey40', 
                    axis_text_color =  'Grey40',
                    axis_x_line_color = 'Grey35',
                    axis_y_line_color = 'Grey35', 
                    tick_color = 'Grey35')
```

These points are quite interesting, but they can be easily explained.
For the left side:
More boys than girls are born globally, you can read about this phenomena here. INSERT HYPERLINK

For the right side:
Women across the globe have higher life expectancies than men. 

Look below and you can see the highlighted age groups. For the remainder of this paper, we will only be looking at the data for people between 20 and 59 years old.

```{r }
#highlight target
#include bar chart in upper right corner showing %women and men
```

The 35-39 age group alone, is made up of 60.1% women! This is also one of the most populous age groups in Hong Kong!

In the 20-59 age group, there are 56% women to 44% men. This group makes up `r sum(filter(pop, age_range == '20 - 24' | age_range == '25 - 29'| age_range == '30 - 34' | age_range == '35 - 39'| age_range == '40 - 44' | age_range == '45 - 49'| age_range == '50 - 54' | age_range == '55 - 59')$population, na.rm = TRUE) / sum(pop$population, na.rm = TRUE)` of the total population of Hong Kong. 

In this group there are `r sum(filter(pop, (sex == 'female') & (age_range == '20 - 24' | age_range == '25 - 29'| age_range == '30 - 34' | age_range == '35 - 39'| age_range == '40 - 44' | age_range == '45 - 49'| age_range == '50 - 54' | age_range == '55 - 59'))$population, na.rm = TRUE) - sum(filter(pop, (sex == 'male') & (age_range == '20 - 24' | age_range == '25 - 29'| age_range == '30 - 34' | age_range == '35 - 39'| age_range == '40 - 44' | age_range == '45 - 49'| age_range == '50 - 54' | age_range == '55 - 59'))$population, na.rm = TRUE)` more women than men.

You can look at the graph below to see which nationalities contribute the most women to the number above.  

```{r }
#diverging lollipop
```

This graph shows us that the Filipinos and Indonesians, individually, contribute almost as many women to the gender gap as the locals of Hong Kong, despite making up a much smaller portion of the overall population. This is likely due to the large numbers of domestic helpers employed by families in Hong Kong, which are almost all women from The Philippines and Indonesia.

So now lets see how the ratio of men to women changes if we exclude domestic helpers from our data. 
```{r }
#two basic bar charts showing how the ratio of men to women change with and without domestic helpers.
```

As you can see from the graphs above, domestic helpers are not solely responsible for the imbalance of men and women, but they do contribute to it. 

There are `r sum(filter(pop, age_range == '0 - 4' | age_range == '5 - 9')$population, na.rm = TRUE)` children between the ages of 0 and 9, while there are `r sum(filter(pop, age_range == '0 - 4' | age_range == '5 - 9')$population, na.rm = TRUE)` domestic helpers in Hong Kong. 

In other words, there are 1.77 children under 10 years old for each domestic helper in Hong Kong. It should be noted that this number is somewhat misleading, since domestic helpers are hired for a variety of reasons including the care of the elderly. Additionally, domestic helpers make up `r sum(only_helpers$population, na.rm = TRUE) / sum(pop$population, na.rm = TRUE)` of the population of Hong Kong, and they undeniably affect the social atmosphere of Hong Kong. 











